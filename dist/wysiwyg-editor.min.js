!function(e){"use strict";if("function"==typeof define&&define.amd)define(["jquery"],function(t){return e(window,document,t)});else{if("undefined"==typeof exports)return e(window,document,jQuery);module.exports=e(window,document,require("jquery"))}}(function(e,t,n){"use strict";var a=function(e,t,n){var a,o,i,r,s,l,c,u;switch(r=Math.floor(6*e),s=6*e-r,l=n*(1-t),c=n*(1-s*t),u=n*(1-(1-s)*t),r%6){case 0:a=n,o=u,i=l;break;case 1:a=c,o=n,i=l;break;case 2:a=l,o=n,i=u;break;case 3:a=l,o=c,i=n;break;case 4:a=u,o=l,i=n;break;case 5:a=n,o=l,i=c}var p=Math.floor(255*a).toString(16),d=Math.floor(255*o).toString(16),f=Math.floor(255*i).toString(16);return"#"+(p.length<2?"0":"")+p+(d.length<2?"0":"")+d+(f.length<2?"0":"")+f},o=function(e){return e.replace(/[&<>"]/g,function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return t[e]||e})},i=function(i,r,s,l,c,u,p,d,f,w,y,h,g,v,m,b,C){var k=function(e,t){t&&(e.getSelectedHTML()?e.insertLink(t):e.insertHTML('<a href="'+o(t)+'">'+o(t)+"</a>")),e.closePopup().collapseSelection()},P=function(e,t){var a=E(u),o=n('<input type="text" value="'+(t?t.attr("href"):"")+'" />').addClass("wysiwyg-input").keypress(function(n){(10==n.which||13==n.which)&&(t?(t.attr("href",o.val()),e.closePopup().collapseSelection()):k(e,o.val()))});d&&o.attr("placeholder",d);var i=a.click(function(n){return t?(t.attr("href",o.val()),e.closePopup().collapseSelection()):k(e,o.val()),n.stopPropagation(),n.preventDefault(),!1}),r=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");return r.append(o).append(i),r},x=function(t){var a=function(e,a){var i='<img id="wysiwyg-insert-image" src="" alt=""'+(a?' title="'+o(a)+'"':"")+" />";t.insertHTML(i).closePopup().collapseSelection();var r=n("#wysiwyg-insert-image").removeAttr("id");w&&r.css({maxWidth:w[0]+"px",maxHeight:w[1]+"px"}).load(function(){r.css({maxWidth:"",maxHeight:""});var e=r.width(),t=r.height();(e>w[0]||t>w[1])&&(e/t>w[0]/w[1]?(t=parseInt(t/e*w[0]),e=w[0]):(e=parseInt(e/t*w[1]),t=w[1]),r.attr("width",e).attr("height",t))}),r.attr("src",e)},i=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on"),r=null,s=n('<input type="file" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!h&&e.File&&e.FileReader&&e.FileList){var l=function(e){if(e.type.match("image.*")){var t=new FileReader;t.onload=function(t){var n=t.target.result;a(n,e.name)},t.readAsDataURL(e)}};r=s.attr("draggable","true").change(function(e){for(var t=e.target.files,n=0;n<t.length;++n)l(t[n])}).on("dragover",function(e){return e.originalEvent.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault(),!1}).on("drop",function(e){for(var t=e.originalEvent.dataTransfer.files,n=0;n<t.length;++n)l(t[n]);return e.stopPropagation(),e.preventDefault(),!1})}else if(y){var c=s.change(function(e){y.call(this,a)});r=n("<form/>").append(c)}r&&n("<div/>").addClass("wysiwyg-browse").html(p).append(r).appendTo(i);var f=E(u),g=n('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(e){(10==e.which||13==e.which)&&a(g.val())});d&&g.attr("placeholder",d);var v=f.click(function(e){return a(g.val()),e.stopPropagation(),e.preventDefault(),!1});return i.append(n("<div/>").append(g).append(v)),i},L=function(e){var t=function(t,a){t=n.trim(t||""),a=n.trim(a||"");var i=!1;t.length&&!a.length?i=t:-1==a.indexOf("<")&&-1==a.indexOf(">")&&a.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)&&(i=a),i&&g&&(a=g(i)||""),!a.length&&i&&(a='<video src="'+o(i)+'" />'),e.insertHTML(a).closePopup().collapseSelection()},a=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on"),i=n("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");f&&i.attr("placeholder",f),n("<div/>").addClass("wysiwyg-embedcode").append(i).appendTo(a);var r=E(u),s=n('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(e){(10==e.which||13==e.which)&&t(s.val())});d&&s.attr("placeholder",d);var l=r.click(function(e){return t(s.val(),i.val()),e.stopPropagation(),e.preventDefault(),!1});return a.append(n("<div/>").append(s).append(l)),a},S=function(e,t){for(var o=n("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on"),i=1;15>i;++i){for(var r=n("<tr/>"),s=0;25>s;++s){var l;if(24==s){var c=Math.floor(255/13*(14-i)).toString(16),u=(c.length<2?"0":"")+c;l="#"+u+u+u}else{var p=s/24,d=8>=i?i/8:1,f=i>8?(16-i)/8:1;l=a(p,d,f)}n("<td/>").addClass("wysiwyg-toolbar-color").attr("title",l).attr("unselectable","on").css({backgroundColor:l}).click(function(){var n=this.title;return t?e.forecolor(n).closePopup().collapseSelection():e.highlight(n).closePopup().collapseSelection(),!1}).appendTo(r)}o.append(r)}return o},T=function(e,t){switch(e){case"insertimage":return t?function(e){t(x(K),e)}:null;case"insertvideo":return t?function(e){t(L(K),e)}:null;case"insertlink":return t?function(e){t(P(K),e)}:null;case"bold":return function(){K.bold()};case"italic":return function(){K.italic()};case"underline":return function(){K.underline()};case"strikethrough":return function(){K.strikethrough()};case"forecolor":return t?function(e){t(S(K,!0),e)}:null;case"highlight":return t?function(e){t(S(K,!1),e)}:null;case"alignleft":return function(){K.align("left")};case"aligncenter":return function(){K.align("center")};case"alignright":return function(){K.align("right")};case"alignjustify":return function(){K.align("justify")};case"subscript":return function(){K.subscript()};case"superscript":return function(){K.superscript()};case"indent":return function(){K.indent()};case"outdent":return function(){K.indent(!0)};case"orderedList":return function(){K.insertList(!0)};case"unorderedList":return function(){K.insertList()};case"removeformat":return function(){K.removeFormat().closePopup().collapseSelection()};case"code":var a=n(K.getElement());return i.addClass("wysiwyg-editor"),function(e){var t=n(e),o=a.html(),r=i.val(),s=i.closest(".wysiwyg-container");t.data("isCodeMode")?(s.removeClass("wysiwyg-code-mode"),o!==r&&a.html(i.val()),i.off("focus blur"),i.hide(),a.show().focus(),t.siblings(".wysiwyg-toolbar-icon").trigger("wysiwyg-toolbar-icon-enable")):(s.addClass("wysiwyg-code-mode"),i.height(a.height()).width(a.width()).css("max-width",a.width()).css("min-width",a.width()),i.on("focus",function(){a.triggerHandler("focus")}),i.on("blur",function(){a.triggerHandler("blur")}),a.hide(),s.find(".wysiwyg-placeholder").hide(),i.show().focus(),t.siblings(".wysiwyg-toolbar-icon").trigger("wysiwyg-toolbar-icon-disable")),t.data("isCodeMode",!t.data("isCodeMode"))}}return null},E=function(e){return n("<a/>").addClass("wysiwyg-toolbar-icon "+(e.classes||"")).attr("href","#").attr("title",e.title).attr("unselectable","on").append(e.image).on("wysiwyg-toolbar-icon-disable",function(){n(this).hasClass("wysiwyg-always-enabled")||(e.hotkey&&(D[e.hotkey]=!0),n(this).addClass("wysiwyg-toolbar-icon-disabled"))}).on("wysiwyg-toolbar-icon-enable",function(){n(this).hasClass("wysiwyg-always-enabled")||(e.hotkey&&(D[e.hotkey]=!1),n(this).removeClass("wysiwyg-toolbar-icon-disabled"))}).on("dragstart",function(){return!1})},M=function(e,t,a,o){n.each(c,function(i,r){if(r&&!(t===!1&&"showstatic"in r&&!r.showstatic||t===!0&&"showselection"in r&&!r.showselection)){var s;s="click"in r?function(e){r.click(n(e))}:"popup"in r?function(e){var t=a(),i=r.popup(t,n(e));o(t,e,i)}:T(i,function(e,t){var n=a();n.append(e),o(n,t),n.find("input[type=text]:first").focus()});var l;s?l=E(r).click(function(e){return n(this).hasClass("wysiwyg-toolbar-icon-disabled")||(s(e.currentTarget),T(i)&&K.getElement().focus()),e.stopPropagation(),e.preventDefault(),!1}):r.html&&(l=n(r.html)),l&&e.append(l)}})},I=function(a,o,i,r){for(var s=o.get(0),l=s.offsetParent,c={left:0,top:0},u=!1,p=!1,d=a.width(),f=l;f;){c.left+=f.offsetLeft,c.top+=f.offsetTop;var w=n(f);"fixed"==w.css("position")&&(u=!0),"visible"!=w.css("overflow")&&(p=!0),f=f.offsetParent}var y=n(l||t.body);y.append(a),i+=s.offsetLeft,r+=s.offsetTop,(u||p)&&(i+d>y.width()-1&&(i=y.width()-d-1),1>i&&(i=1));var h=n(e).width();c.left+i+d>h-1&&(i=h-c.left-d-1);var g=u?0:n(e).scrollLeft();c.left+i<g+1&&(i=g-c.left+1),a.css({left:parseInt(i)+"px",top:parseInt(r)+"px"})},H={},D={},j=null,U=function(e,t,a,o){var i=function(e,t,a,o,i,r,s){if(C){var l=j||"";switch(t){case 8:l=l.substring(0,l.length-1);case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:if(e)return;a=!1;break;default:if(!e)return;l+=a}var u=C(l,t,a,o,i,r,s);if("object"!=typeof u||!u.length)return c.closePopup(),j=null,u;var p=n(c.openPopup());p.hide().addClass("wysiwyg-popup wysiwyg-popuphover").empty().append(u),j=l}},r={element:e.get(0),onKeyDown:function(e,t,n,a,o,r){if(v&&v(e,t,n,a,o,r)===!1)return!1;if(t&&!n&&!a&&o&&!r){var s=t.toLowerCase();if(!H[s]||D[s])return;return H[s](),!1}return i(!1,e,t,n,a,o,r)},onKeyPress:function(e,t,n,a,o,r){return m&&m(e,t,n,a,o,r)===!1?!1:i(!0,e,t,n,a,o,r)},onKeyUp:function(e,t,n,a,o,i){return b&&b(e,t,n,a,o,i)===!1?!1:void 0},onSelection:function(e,t,o,i){var r=!0,s=null;if(e&&n.each(o,function(e,t){return 0!=n(t).parents("a").length?(s=P(c,n(t).parents("a:first")),!1):void 0}),c.readOnly()?r=!1:t?s||i||j||(-1==n.inArray("selection",l.split("-"))?r=!1:e?r=!1:1==o.length&&"IMG"==o[0].nodeName&&(r=!1)):r=!1,!r)return void c.closePopup();var u,p=function(){var e=u.outerWidth(),o=a.offset(),i=n(c.getElement()).offset(),r=t.left+parseInt(t.width/2)-parseInt(e/2)+i.left-o.left,s=t.top+t.height+i.top-o.top;I(u,a,r,s)};u=n(c.openPopup()),u.hasClass("wysiwyg-popuphover")&&!u.data("special")==!s||(u=n(c.closePopup().openPopup())),j?u.show():u.hasClass("wysiwyg-popup")||(u.addClass("wysiwyg-popup wysiwyg-popuphover"),s?u.empty().append(s).data("special",!0):M(u,!0,function(){return u.empty()},p)),p()},onOpenpopup:function(){W()},onClosepopup:function(){j=null,q()},hijackContextmenu:"selection"==l,readOnly:!!e.attr("readonly")};if(o){var s=n("<div/>").addClass("wysiwyg-placeholder").html(o).hide();a.prepend(s),r.onPlaceholder=function(e){e?s.show():s.hide()}}var c=wysiwyg(r);return c},A=n("<div/>").addClass("wysiwyg-container");r&&A.addClass(r),i.wrap(A),A=i.parent(".wysiwyg-container");var F=!1;s&&(F=n("<div/>").addClass("wysiwyg-wrapper").click(function(){K.getElement().focus()}),i.wrap(F),F=i.parent(".wysiwyg-wrapper"));var K=U(i,A,s?F:A,s);if(K.legacy){var i=n(K.getElement());i.addClass("wysiwyg-textarea"),i.is(":visible")&&i.width(A.width()-(i.outerWidth()-i.width()))}else n(K.getElement()).addClass("wysiwyg-editor");var O=null,W=function(){O&&clearTimeout(O),O=null,A.addClass("wysiwyg-active"),A.find(".wysiwyg-toolbar-focus").slideDown()},q=function(){O||t.activeElement==K.getElement()||(O=setTimeout(function(){A.removeClass("wysiwyg-active"),0==n.trim(K.getHTML().replace(/<br\s*[\/]?>/gi,"")).length&&A.find(".wysiwyg-toolbar-focus").slideUp()},100))};n(K.getElement()).focus(W).blur(q);var R={};if(n.each(c,function(e,t){if(t&&t.hotkey){var n=T(e);n&&(H[t.hotkey.toLowerCase()]=n,R[e]=n)}}),!n.isEmptyObject(c)&&"selection"!=l){var $=-1!=n.inArray("top",l.split("-")),z=-1!=n.inArray("focus",l.split("-")),G=n("<div/>").addClass("wysiwyg-toolbar").addClass($?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");z&&G.hide().addClass("wysiwyg-toolbar-focus"),M(G,!1,function(){var e=n(K.openPopup());return e.hasClass("wysiwyg-popup")&&e.hasClass("wysiwyg-popuphover")&&(e=n(K.closePopup().openPopup())),e.hasClass("wysiwyg-popup")||e.addClass("wysiwyg-popup"),e},function(e,t,a){var o=n(t),i=e.outerWidth(),r=o.offset().left-A.offset().left+parseInt(o.width()/2)-parseInt(i/2),s=o.offset().top-A.offset().top;$?s+=o.outerHeight():s-=e.outerHeight(),a&&(r=a.left,s=a.top),I(e,A,r,s)}),$?A.prepend(G):A.append(G)}return{wysiwygeditor:K,$container:A}};n.fn.wysiwyg=function(e,t){if(!e||"object"==typeof e)return e=n.extend({},e),this.each(function(){var t=n(this);if(!t.data("wysiwyg")){var a=e.classes,o=e.placeholder||t.attr("placeholder"),r=e.toolbar||"top",s=e.buttons||{},l=e.submit,c=e.selectImage,u=e.placeholderUrl||null,p=e.placeholderEmbed||null,d=e.maxImageSize||null,f=e.onImageUpload||null,w=e.forceImageUpload&&f,y=e.videoFromUrl||null,h=e.onKeyDown||null,g=e.onKeyPress||null,v=e.onKeyUp||null,m=e.onAutocomplete||null,b=i(t,a,o,r,s,l,c,u,p,d,f,w,y,h,g,v,m);t.data("wysiwyg",b)}});if(1==this.length){var a=this.data("wysiwyg");if(!a)return this;if("container"==e)return a.$container;if("shell"==e)return a.wysiwygeditor}return this}});
